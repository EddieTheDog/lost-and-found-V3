<!DOCTYPE html>
<html>
<head>
  <title>Live Barcode Scan</title>
</head>
<body>
  <button id="startBtn">Start Scan</button>
  <video id="video" width="400" height="300" autoplay></video>
  <div id="result"></div>

  <!-- ZXing UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@zxing/library@0.19.1/dist/index.min.js"></script>

  <script>
    window.onload = function() {
      const startBtn = document.getElementById('startBtn');
      const video = document.getElementById('video');
      const resultDiv = document.getElementById('result');
      const codeReader = new ZXing.BrowserMultiFormatReader();

      let lastCode = null;

      startBtn.addEventListener('click', async () => {
        try {
          const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } });
          video.srcObject = stream;

          const devices = await codeReader.listVideoInputDevices();
          if(devices.length === 0){ alert('No camera found'); return; }
          const deviceId = devices[0].deviceId;

          codeReader.decodeFromVideoDevice(deviceId, video, (result, err) => {
            if(result && result.getText() !== lastCode){
              lastCode = result.getText();
              resultDiv.innerText = "Scanned: " + lastCode;
            }
          });
        } catch(e) {
          alert('Camera access denied or not available');
        }
      });
    }
  </script>
</body>
</html>
