<%- include('layout') %>

<h1>Admin Dashboard</h1>

<h2>Claims</h2>
<ul>
  <% claims.forEach(claim => { %>
    <li>
      <b><%= claim.name %></b> (<%= claim.email %>, <%= claim.phone %>)
      <% if (claim.password) { %> [Protected] <% } %>
      <form method="POST" action="/delete-claim" style="display:inline;">
        <input type="hidden" name="claimId" value="<%= claim.id %>">
        <button type="submit">Delete Claim</button>
      </form>
      <ul>
        <% claim.itemIds.forEach(itemId => {
             const item = items.find(i => i.id === itemId);
        %>
          <li><%= item ? item.name : 'Deleted item' %> - <%= item ? item.description : '' %></li>
        <% }) %>
      </ul>
    </li>
  <% }) %>
</ul>

<h2>Items</h2>
<ul id="recentScanned">
  <% items.forEach(item => { %>
    <li>
      <b><%= item.name %></b> - <%= item.description %> (Location: <%= item.location %>)
      <form method="POST" action="/edit-item" style="display:inline;">
        <input type="hidden" name="id" value="<%= item.id %>">
        <input type="text" name="name" value="<%= item.name %>" required>
        <input type="text" name="description" value="<%= item.description %>">
        <input type="text" name="location" value="<%= item.location %>">
        <button type="submit">Edit</button>
      </form>
    </li>
  <% }) %>
</ul>

<script src="/socket.io/socket.io.js"></script>
<script>
  const socket = io();
  const recent = document.getElementById('recentScanned');

  socket.on('scan', code => {
    const li = document.createElement('li');
    li.textContent = code + ' (from scanner)';
    recent.prepend(li);
    if (recent.children.length > 10) recent.removeChild(recent.lastChild);
  });
</script>
